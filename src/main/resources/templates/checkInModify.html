<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta charset="utf-8"/>
    <title>值机信息录入</title>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"-->
    <!--integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">-->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/css/registration.css}"/>
    <!-- 引用jquery -->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>-->
    <script th:src="@{/js/jquery.min.js}" type="text/javascript"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"-->
    <!--integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"-->
    <!--crossorigin="anonymous"></script>-->
    <script th:src="@{/js/bootstrap.min.js}"></script>
</head>
<body>
<div class="mainContainer">
    <form>
        <div class="form-group">
            <div class="text-center">
                <h2>值机信息修改</h2>
            </div>
        </div>
        <label>
            <input hidden="hidden" name="id" th:id="recordId" th:value="${checkInRecord.id}">
        </label>
        <div class="row">
            <div class="form-group col-sm-offset-3 col-sm-6">
                <label for="flightNumber" class="control-label">航班选择：</label>
                <input class="form-control" id="flightNumber" name="flightNumber" type="text"
                       th:value="${checkInRecord.flightNumber}" disabled>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-sm-offset-3 col-sm-6">
                <label for="peopleNumber" class="control-label">实际人数：</label>
                <div class="">
                    <input type="number" class="form-control" id="peopleNumber" required name="realNumber"
                           th:value="${checkInRecord.realNumber}" placeholder="请输入实际人数"
                           onKeypress="return (/[\d]/.test(String.fromCharCode(event.keyCode)))">
                </div>
            </div>

        </div>
        <div class="row">
            <div class="form-group col-sm-offset-3 col-sm-6">
                <label for="baggageNumber" class="control-label">实际行李件数：</label>
                <div class="">
                    <input type="number" class="form-control" id="baggageNumber" name="luggageNumber" required
                           placeholder="请输入实际行李件数" th:value="${checkInRecord.luggageNumber}"
                           onKeypress="return (/[\d]/.test(String.fromCharCode(event.keyCode)))">
                </div>
            </div>

        </div>
        <div class="row">
            <div class="form-group col-sm-offset-3 col-sm-6">
                <label for="specialCircumstances" class="control-label">特殊情况说明：</label>
                <div class="">
                    <textarea class="form-control" name="specialCase" rows="3" id="specialCircumstances">[[${checkInRecord.specialCase}]]</textarea>
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-sm-offset-3 col-sm-2">
                <a class="btn btn-lg btn-primary btn-block" th:href="@{/checkIn/search}">取消修改</a>
            </div>
            <div class="col-sm-offset-2 col-sm-2">
                <button type="button" id="check-btn" onclick="checkSubmit()" class="btn btn-lg btn-success btn-block">
                    修改上传
                </button>
            </div>
        </div>
    </form>
</div>
</body>
<script type="text/javascript" th:inline="javascript">

    var checkSubmit = function () {
        console.log("执行查询函数");
        $("#check-btn").attr("disabled", "disabled");

        // 封装数据
        $.ajax({
            type: "POST",
            url: "/checkIn/modify",
            dataType: "json",
            data: {
                "id": $("#recordId").val(),
                "flightInformationId": $('#flightInformationId').val(),
                "realNumber": $("#peopleNumber").val(),
                "luggageNumber": $("#baggageNumber").val(),
                "specialCase": $("#specialCircumstances").val()
            },
            success: function (response) {
                if (response.status === 200) {
                    // 请求成功
                    alert("记录修改成功,现在返回！");
                    // 数据修改成功，重新跳转回查询界面
                    window.location.href = "/checkIn/search";
                } else {
                    alert("修改失败，请稍后重试！");
                }
            },
            error: function (xhr) {
                console.log("错误提示： " + xhr + " ---- " + xhr.status + " " + xhr.statusText);
            },
            //请求完成后回调函数 (请求成功或失败之后均调用)。参数： XMLHttpRequest 对象和一个描述成功请求类型的字符串
            complete: function (XMLHttpRequest, textStatus) {
                console.log("函数调用完成，将按钮设置为可用状态");
                // 请求完成，将按钮重置为可用
                $("#check-btn").removeAttr("disabled");
            }
        });
    };
</script>
</html>